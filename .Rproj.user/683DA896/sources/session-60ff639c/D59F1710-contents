---
title: "A2_Group5"
author: "Mirre Dona (6156630)"
date: "2023-11-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Load libraries
```{r}
library(ISLR) 
library(tidyverse) 
library(readr) # for data import
library(dplyr)
library(magrittr) # for pipes
library(mice) # for missing data
library(ggplot2) # for plotting
library(psych)

library(randomForest)
library(rpart)
library(rpart.plot)

```

# Import dataset
```{r}
sleepdata <- read.csv('data/Sleep_health_and_lifestyle_dataset.csv')
View(sleepdata)
```

# Description of the data
The Sleep Health and Lifestyle Dataset, here called sleepdata, consists of 400 rows and 13 columns. The dataset consists of sleep-related data. A lot of variables are presented, including gender, age, occupation, sleep duration, quality of sleep, physical activity levels, stress levels, BMI category, blood pressure, heart rate, daily steps, and, if it is the case, the sleep disorders. This dataset offers the opportunity to gain insights into whether sleep factors and lifestyle factors are related.

To download the dataset, click [here](https://www.kaggle.com/code/jillanisofttech/sleep-health-and-lifestyle-predication-with-94-ac).

With this dataset, we aim to predict a person's sleep quality. We chose this response variable as we think it is valuable information for a person. Sleep quality is important for your health and can affect mental-health issues. It also influences how you feel during the day, which affects the activities you undertake and how well you do them.

# Data cleaning
Before we begin, the data should be cleaned for proper use.
## Missing data
```{r}
md.pattern(sleepdata)
```
There is no missing data in this dataset!

## Transform variable types
Let's convert the variables to the right type for exploration and prediction later on.
```{r}
#check how many unique values of occupation, to see if it makes sense to convert to factor, or if there are too many unique values
unique(sleepdata$Occupation)
```

```{r}
sleepdata %<>% 
  mutate(Gender   = as.factor(Gender),
         Occupation = as.factor(Occupation),
         BMI.Category = as.factor(BMI.Category))
```

## Select variables
For our analysis and prediction we do not need the person identifier of each case, so we remove this variable.
```{r}
sleepdata %<>% select(-Person.ID)
```


## Outlier removal
Check outliers


# Exploratory data analysis

```{r}
#summary of the data
summary(sleepdata)

#check for the most important variables

# use ggplot2 to plot the data of sleep quality compared to sleep duration
plot_sleepdata <- sleepdata %>% 
  ggplot(aes(x=Quality.of.Sleep, y=Sleep.Duration)) + 
  geom_point(position = "jitter") + 
  theme_minimal() +
  geom_smooth() +
  labs(title="Sleep quality compared to sleep duration", x="Sleep quality", y="Sleep duration")
plot_sleepdata

# create a boxplot of the sleep quality per sleep duration.
plot_sleepdata2 <- sleepdata %>% mutate(
  Quality.of.Sleep = as.factor(Quality.of.Sleep)
) %>% 
  ggplot(aes(x=Quality.of.Sleep, y=Sleep.Duration)) + 
  geom_boxplot() + 
  theme_minimal() +
  labs(title="Sleep quality compared to sleep duration", x="Sleep quality", y="Sleep duration")
plot_sleepdata2

ggplot(sleepdata, aes(x = Gender, y = Quality.of.Sleep)) +
  geom_boxplot(fill = "lightblue") +
  labs(title = "Sleep Quality by Gender", y = "Quality of Sleep")

ggplot(sleepdata, aes(x = Occupation)) +
  geom_bar()

sleepdata %>% 
  group_by(Occupation) %>% 
  summarise( 
    median = median(Sleep.Duration),
    min = min(Sleep.Duration),
    max = max(Sleep.Duration),
    mad = mad(Sleep.Duration) # Adding median absolute deviation 
  )

sleepdata %>% 
  ggplot(aes(x = BMI.Category, y = Daily.Steps)) + 
  scale_x_discrete(limits = c("Normal", "Normal Weight", "Overweight", "Obese")) +
  geom_boxplot()
```

# Prediction model
As described above, the response variable we chose to predict is quality of sleep. ...

## Feature selection
To create a well performing model to predict sleep quality, it is important to consider which features to use as predictors. To find the most informative predictors, we will inspect the correlation between sleep quality and the other variables in the dataset. We will also use a feature selection method to find the best predictors. 

### Correlation

```{r}
##Classification tree

tree_mod <- rpart(Quality.of.Sleep ~ ., data = sleepdata)
rpart.plot(tree_mod) #plot tree

##Random forest
rf_mod <- randomForest(Quality.of.Sleep ~ ., data = sleepdata)
rf_mod
importance <- importance(rf_mod)

tibble(
  importance = c(importance), 
  variable = rownames(importance)
) %>% 
  ggplot(aes(x = variable, y = importance, fill = variable)) +
  geom_bar(stat = "identity")

#boosting
gbm_train <- train(Quality.of.Sleep ~ .,
                   data = sleepdata,
                   method = "gbm",
                   verbose = F, 
                   trControl = cvcontrol) #print bag_train, rf_train, gbm_train models to see accuracy
summary(gbm_train) #var importance plot
predictions <- predict(gbm_train)

### PCA (of wa anders)

<<<<<<< HEAD
```
From this, it can be seen that it is not true that most people rated their sleep quality with 7. So other reasons behind this variety can be tested. However, it is clear that less people rated their sleep quality with 4 or 5, which could be a reason why there is less variety in sleep duration when the sleep quality is 4 or 5 (viewed in the boxplot).
=======
>>>>>>> 728a474b78c4895536e7678d16eaa02d7f2b96e2


